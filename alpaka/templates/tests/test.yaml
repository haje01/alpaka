apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "common.names.fullname" . }}-test"
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  initContainers:
  - name: git-cloner
    image: alpine/git
    args:
    - clone 
    - -- 
    - https://github.com/haje01/alpaka.git
    - /target
    volumeMounts:
    - mountPath: /target
      name: alpaka-src
  containers:
  - name: test
    image: "{{ .Values.tool.image.repository }}:{{ .Values.tool.image.tag | default .Chart.AppVersion }}"
    command: ['pytest']
    args: ['/alpaka/tests']
    volumeMounts:
    - mountPath: /alpaka
      name: alpaka-src
  restartPolicy: Never
  volumes:
  - name: alpaka-src
    emptyDir: {}
